<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <title>GALLERY | 396 FOLIO</title>
    <link rel="icon" href="img/profile/profile_avatar.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/destyle.css@1.0.15/destyle.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/config.js"></script>
    <script src="js/components.js" defer></script>
    <script src="js/main.js" defer></script>
</head>

<body>
    <site-header></site-header>
    <main>
        <section class="container">
            <section-title title="GALLERY" center reveal></section-title>

            <!-- Category Description -->
            <glass-card id="category-info" reveal>
                <h3 id="category-title">All Works</h3>
                <p id="category-text">これまでに制作したすべての作品をご覧いただけます。水彩、鉛筆、デジタル、それぞれの表現の追求をお楽しみください。</p>
            </glass-card>

            <!-- Filter Buttons -->
            <div class="filter-wrap reveal">
                <button class="filter-btn active" data-category="all">ALL</button>
                <button class="filter-btn" data-category="watercolor">WATERCOLOR</button>
                <button class="filter-btn" data-category="pencil">PENCIL</button>
                <button class="filter-btn" data-category="digital">DIGITAL</button>
            </div>

            <!-- Gallery Grid -->
            <div id="gallery-grid" class="gallery-grid">
                <!-- JavaScript will populate this -->
            </div>
        </section>
    </main>
    <site-footer></site-footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('gallery-grid');
            const infoTitle = document.getElementById('category-title');
            const infoText = document.getElementById('category-text');
            const filterBtns = document.querySelectorAll('.filter-btn');

            const categories = {
                all: {
                    title: 'All Works',
                    text: 'これまでに制作したすべての作品をご覧いただけます。水彩、鉛筆、デジタル、それぞれの表現の追求をお楽しみください。'
                },
                watercolor: {
                    title: 'Water color',
                    text: '透明感のある水彩の調べ。繊細なタッチと柔らかな色使いで、見る人の心に静かな感動を届けられるような作品集です。'
                },
                pencil: {
                    title: 'Pencil drawing',
                    text: '鉛筆の柔らかな線。日常の中にある一瞬の感情を切り取った、子どもやアンニュイな表情の人々のデッサン集です。'
                },
                digital: {
                    title: 'Digital art',
                    text: 'ポップでカラフル。iPadを使ったビビッドな色使いと楽しいデザインで、見た人が思わず笑顔になるような作品集です。'
                }
            };

            const imagePaths = {
                watercolor: 'img/gallery/watercolor',
                pencil: 'img/gallery/pencil',
                digital: 'img/gallery/digital'
            };

            // Smart Loader: Probes folders for images automatically
            async function loadImages() {
                const loadPromises = [];

                for (const [cat, path] of Object.entries(imagePaths)) {
                    // Probe images 1 to 30 for each category
                    for (let i = 1; i <= 30; i++) {
                        const p = new Promise(resolve => {
                            const img = new Image();
                            const src = `${path}/${i}.jpg`;
                            img.onload = () => {
                                const item = document.createElement('div');
                                item.className = 'gallery-item reveal';
                                item.dataset.category = cat;
                                item.innerHTML = `<img src="${src}" alt="${cat} image" loading="lazy">`;
                                resolve(item);
                            };
                            img.onerror = () => resolve(null);
                            img.src = src;
                        });
                        loadPromises.push(p);
                    }
                }

                const results = await Promise.all(loadPromises);

                // Sort results to keep categories together if needed, 
                // or just append as they were found
                results.forEach(item => {
                    if (item) {
                        grid.appendChild(item);
                        // Connect to global reveal observer if available
                        if (window.revealObserver) {
                            window.revealObserver.observe(item);
                        }
                    }
                });
            }

            // Filtering with smooth transitions
            function filterGallery(category) {
                const items = document.querySelectorAll('.gallery-item');
                const infoCard = document.getElementById('category-info');

                // Update text with fade effect
                infoCard.style.opacity = '0';
                infoCard.style.transform = 'translateY(10px)';

                setTimeout(() => {
                    infoTitle.textContent = categories[category].title;
                    infoText.textContent = categories[category].text;
                    infoCard.style.opacity = '1';
                    infoCard.style.transform = 'translateY(0)';
                }, 300);

                items.forEach(item => {
                    if (category === 'all' || item.dataset.category === category) {
                        item.style.display = 'block';
                        setTimeout(() => {
                            item.classList.remove('hidden');
                            item.style.transform = 'scale(1)';
                            item.style.opacity = '1';
                        }, 10);
                    } else {
                        item.classList.add('hidden');
                        item.style.transform = 'scale(0.9)';
                        item.style.opacity = '0';
                        setTimeout(() => {
                            if (item.classList.contains('hidden')) {
                                item.style.display = 'none';
                            }
                        }, 500);
                    }
                });
            }

            // Initialization
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.classList.contains('active')) return;
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterGallery(btn.dataset.category);
                });
            });

            loadImages();
        });
    </script>
</body>

</html>